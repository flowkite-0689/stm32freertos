#include "timer_general.h"

// 根据 nnnn.md 示例文件的正确实现
// 6/8拍：8分音符为一拍，每小节6个8分音符
// 八度：1h=高音(八度5), 1=中音(八度4), 1L=低音(八度3)
// 时值规则：
// - 3h = 四分音符（无下划线）
// - 3h_ = 八分音符（一条下划线）
// - 3h__ = 十六分音符（两条下划线）
// - 3h_-_ = 八分音符+延音（基础八分音符延长一倍）

// 示例：3h 2h_ 1h 2h_ | 3h_-_ 4h__ 3h_ 2h-
// 按照6/8拍 BPM=97，基础单位为八分音符619ms

NumberedNote example_melody[] = {
    // 小节1: 3h 2h_ 1h 2h_ | 
    {3, 5, 0, 0, 0, 0},    // 3h - 高音3，四分音符，1238ms
    {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    {1, 5, 0, 0, 0, 0},    // 1h - 高音1，四分音符，1238ms
    {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    
    // 小节2: 3h_-_ 4h__ 3h_ 2h-
    {3, 5, 0, 1, 1, 0},    // 3h_-_ - 高音3，八分音符+延音=1238ms
    {4, 5, 0, 2, 0, 0},    // 4h__ - 高音4，十六分音符，310ms
    {3, 5, 0, 1, 0, 0},    // 3h_ - 高音3，八分音符，619ms
    {2, 5, 0, 0, 0, 0}  ,   // 2h- - 高音2，四分音符，1238ms（延音标记）


    // // 小节1: 3h 2h_ 1h 2h_ | 
    // {3, 5, 0, 0, 0, 0},    // 3h - 高音3，四分音符，1238ms
    // {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    // {1, 5, 0, 0, 0, 0},    // 1h - 高音1，四分音符，1238ms
    // {2, 5, 0, 1, 0, 0},    // 2h_ - 高音2，八分音符，619ms
    
    // // 小节2: 3h_-_ 4h__ 3h_ 2h-
    // {3, 5, 0, 1, 1, 0},    // 3h_-_ - 高音3，八分音符+延音=1238ms
    // {4, 5, 0, 2, 0, 0},    // 4h__ - 高音4，十六分音符，310ms
    // {3, 5, 0, 1, 0, 0},    // 3h_ - 高音3，八分音符，619ms
    // {2, 5, 0, 0, 0, 0}     // 2h- - 高音2，四分音符，1238ms（延音标记）
};

// 时值符号详细演示
NumberedNote timing_demo[] = {
    {1, 4, 0, 0, 0, 0},    // 1 - 四分音符 = 2拍 = 1238ms
    {1, 4, 0, 1, 0, 0},    // 1_ - 八分音符 = 1拍 = 619ms
    {1, 4, 0, 2, 0, 0},    // 1__ - 十六分音符 = 0.5拍 = 310ms
    {1, 4, 0, 1, 1, 0},    // 1_-_ - 八分音符+延音 = 2拍 = 1238ms
    {1, 4, 0, 0, 0, 1},    // 1. - 四分音符+附点 = 3拍 = 1857ms
    {1, 4, 0, 1, 0, 1}     // 1_. - 八分音符+附点 = 1.5拍 = 929ms
};

// 《春日影》修正版 - 根据正确规则解析
// 第一行: 3h 2L 1 2L | 3h. 4 3h 2h.
NumberedNote haruhi_correct[] = {
    // 第一小节
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符，1238ms
    {2, 3, 0, 1, 0, 0},     // 2L - 低音2，八分音符，619ms
    {1, 4, 0, 0, 0, 0},     // 1 - 中音1，四分音符，1238ms
    {2, 3, 0, 1, 0, 0},     // 2L - 低音2，八分音符，619ms
    {3, 5, 0, 0, 0, 1},     // 3h. - 高音3，四分音符+附点，1857ms
    {4, 4, 0, 0, 0, 0},     // 4 - 中音4，四分音符，1238ms
    {3, 5, 0, 0, 0, 0},     // 3h - 高音3，四分音符，1238ms
    {2, 5, 0, 0, 0, 1}      // 2h. - 高音2，四分音符+附点，1857ms
};

// 播放函数
void play_example_melody(void)
{
    // 使用6/8拍，BPM=97
    Play_Numbered_Melody(example_melody, 
                        sizeof(example_melody)/sizeof(NumberedNote), 
                        TIME_SIGNATURE_6_8, 
                        97);
}

void play_timing_demo(void)
{
    // 演示不同时值符号
    Play_Numbered_Melody(timing_demo, 
                        sizeof(timing_demo)/sizeof(NumberedNote), 
                        TIME_SIGNATURE_6_8, 
                        97);
}

void play_haruhi_correct(void)
{
    // 播放修正版《春日影》
    Play_Numbered_Melody(haruhi_correct, 
                        sizeof(haruhi_correct)/sizeof(NumberedNote), 
                        TIME_SIGNATURE_6_8, 
                        97);
}
