# å¢å¼ºç‰ˆæ•°å­—ç®€è°±è½¬æ¢æŒ‡å—

## å®Œæ•´çš„éŸ³ç¬¦å…«åº¦ç³»ç»Ÿ

### æ–‡æœ¬è¡¨ç¤ºè§„åˆ™

| ç¬¦å· | å…«åº¦ | ä»£ç è¡¨ç¤º | é¢‘ç‡èŒƒå›´ |
|------|------|----------|----------|
| 1Ì² (ä¸‹åŠ ç‚¹) | ä½éŸ³(å…«åº¦3) | {1, 3} | 131-247Hz |
| 1 (æ— æ ‡è®°) | ä¸­éŸ³(å…«åº¦4) | {1, 4} | 262-494Hz |
| 1Ì‡ (ä¸ŠåŠ ç‚¹) | é«˜éŸ³(å…«åº¦5) | {1, 5} | 523-988Hz |
| 0 | ä¼‘æ­¢ç¬¦ | {0, 0} | 0Hz |

### å‡é™è°ƒè¡¨ç¤º

| ç¬¦å· | å«ä¹‰ | ä»£ç è¡¨ç¤º | é¢‘ç‡è°ƒæ•´ |
|------|------|----------|----------|
| # | å‡å· | {note, octave, 1} | +6%(åŠéŸ³) |
| b | é™å· | {note, octave, 2} | -6%(åŠéŸ³) |
| æ— æ ‡è®° | è‡ªç„¶éŸ³ | {note, octave, 0} | æ— è°ƒæ•´ |

## å®Œæ•´çš„æ—¶å€¼ç³»ç»Ÿ

### æ‹å·æ”¯æŒ

| æ‹å· | åŸºæœ¬å•ä½ | ä»£ç  | ç”¨é€” |
|------|----------|------|------|
| 4/4 | å››åˆ†éŸ³ç¬¦ | TIME_SIGNATURE_4_4 | æµè¡Œã€æ°‘è°£ |
| 3/4 | å››åˆ†éŸ³ç¬¦ | TIME_SIGNATURE_3_4 | åœ†èˆæ›² |
| 6/8 | å…«åˆ†éŸ³ç¬¦ | TIME_SIGNATURE_6_8 | å¤åˆæ‹å­ |

### æ—¶å€¼ç¬¦å·è¯¦è§£

#### åŸºç¡€æ—¶å€¼ï¼ˆä»¥6/8æ‹ï¼ŒBPM=97ä¸ºä¾‹ï¼‰

| ç¬¦å· | åç§° | åŸºç¡€å€¼ | å®é™…æ—¶é•¿(ms) | ä»£ç  |
|------|------|--------|--------------|------|
| â™ª | å…«åˆ†éŸ³ç¬¦ | 1 | 619 | {base:2, dotted:0, ties:0} |
| â™ª. | é™„ç‚¹å…«åˆ†éŸ³ç¬¦ | 1.5 | 929 | {base:2, dotted:1, ties:0} |
| â™© | å››åˆ†éŸ³ç¬¦ | 2 | 1238 | {base:4, dotted:0, ties:0} |
| â™©. | é™„ç‚¹å››åˆ†éŸ³ç¬¦ | 3 | 1857 | {base:4, dotted:1, ties:0} |
| ğ…—ğ…¥ | äºŒåˆ†éŸ³ç¬¦ | 4 | 2476 | {base:8, dotted:0, ties:0} |

#### å»¶éŸ³çº¿ç¬¦å·

| ç¬¦å· | ä½œç”¨ | ä»£ç  | æ—¶é•¿å€æ•° |
|------|------|------|----------|
| 3_ | å•å»¶éŸ³çº¿ | ties:1 | Ã—2 |
| 3__ | åŒå»¶éŸ³çº¿ | ties:2 | Ã—4 |

#### é™„ç‚¹è¯¦è§£

**é™„ç‚¹ä½œç”¨**ï¼šåœ¨åŸæ—¶å€¼åŸºç¡€ä¸Šå¢åŠ 50%

- å…«åˆ†éŸ³ç¬¦ â™ª = 1æ‹ â†’ é™„ç‚¹å…«åˆ†éŸ³ç¬¦ â™ª. = 1.5æ‹
- å››åˆ†éŸ³ç¬¦ â™© = 2æ‹ â†’ é™„ç‚¹å››åˆ†éŸ³ç¬¦ â™©. = 3æ‹

## å¢å¼ºçš„æ•°æ®ç»“æ„

### NumberedNoteç»“æ„ä½“

```c
typedef struct {
    uint8_t note;          // éŸ³ç¬¦(1-7, 0=ä¼‘æ­¢ç¬¦)
    uint8_t octave;        // å…«åº¦(3=ä½éŸ³, 4=ä¸­éŸ³, 5=é«˜éŸ³)
    uint8_t accidental;    // å‡é™å·(0=æ— , 1=å‡å·#, 2=é™å·b)
    uint8_t base_duration; // åŸºç¡€æ—¶å€¼(1=åå…­, 2=å…«, 4=å››, 8=äºŒ, 16=å…¨)
    uint8_t dotted;        // æ˜¯å¦ä¸ºé™„ç‚¹(0=å¦, 1=æ˜¯)
    uint8_t ties;          // å»¶éŸ³çº¿æ•°é‡(0-2)
} NumberedNote;
```

### è½¬æ¢ç¤ºä¾‹

#### ç®€è°±ç¬¦å· â†’ ç»“æ„ä½“

| ç®€è°± | ç»“æ„ä½“è¡¨ç¤º |
|------|------------|
| 3Ì‡ | {3, 5, 0, 2, 0, 0} |
| 2Ì² | {2, 3, 0, 2, 0, 0} |
| 3Ì‡. | {3, 5, 0, 4, 1, 0} |
| 5# | {5, 4, 1, 2, 0, 0} |
| 3_ | {3, 4, 0, 2, 0, 1} |

## 6/8æ‹è½¬æ¢è¯¦è§£

### æ—¶é•¿è®¡ç®—å…¬å¼

1. **åŸºç¡€æ—¶é•¿è®¡ç®—**ï¼š
   ```
   base_duration = 60000ms / BPM / (base_note_value / 4.0)
   ```
   
2. **6/8æ‹ç¤ºä¾‹ï¼ˆBPM=97ï¼‰**ï¼š
   ```
   // 6/8æ‹ï¼šåŸºç¡€å•ä½ä¸ºå…«åˆ†éŸ³ç¬¦
   base_duration = 60000 / 97 / (8 / 4.0) = 619ms
   ```

3. **å®é™…éŸ³ç¬¦æ—¶é•¿**ï¼š
   ```
   duration = base_duration * 4 / base_duration_value
   if (dotted) duration += duration / 2
   for (i = 0; i < ties; i++) duration *= 2
   ```

### å®Œæ•´è½¬æ¢ç¤ºä¾‹ï¼šã€Šæ˜¥æ—¥å½±ã€‹

#### ç¬¬ä¸€å°èŠ‚ï¼š3Ì‡ 2Ì² 1 2Ì² | 3Ì‡. 4 3Ì‡ 2Ì‡.

```c
// è½¬æ¢ä¸ºNumberedNoteæ•°ç»„
NumberedNote melody[] = {
    {3, 5, 0, 2, 0, 0},  // 3Ì‡ - é«˜éŸ³Miï¼Œå…«åˆ†éŸ³ç¬¦ï¼Œæ— é™„ç‚¹ï¼Œæ— å»¶éŸ³
    {2, 3, 0, 2, 0, 0},  // 2Ì² - ä½éŸ³Reï¼Œå…«åˆ†éŸ³ç¬¦ï¼Œæ— é™„ç‚¹ï¼Œæ— å»¶éŸ³
    {1, 4, 0, 2, 0, 0},  // 1 - ä¸­éŸ³Doï¼Œå…«åˆ†éŸ³ç¬¦ï¼Œæ— é™„ç‚¹ï¼Œæ— å»¶éŸ³
    {2, 3, 0, 2, 0, 0},  // 2Ì² - ä½éŸ³Reï¼Œå…«åˆ†éŸ³ç¬¦ï¼Œæ— é™„ç‚¹ï¼Œæ— å»¶éŸ³
    {3, 5, 0, 4, 1, 0},  // 3Ì‡. - é«˜éŸ³Miï¼Œé™„ç‚¹å››åˆ†éŸ³ç¬¦ï¼Œæ— å»¶éŸ³
    {4, 4, 0, 2, 0, 0},  // 4 - ä¸­éŸ³Faï¼Œå…«åˆ†éŸ³ç¬¦ï¼Œæ— é™„ç‚¹ï¼Œæ— å»¶éŸ³
    {3, 5, 0, 2, 0, 0},  // 3Ì‡ - é«˜éŸ³Miï¼Œå…«åˆ†éŸ³ç¬¦ï¼Œæ— é™„ç‚¹ï¼Œæ— å»¶éŸ³
    {2, 5, 0, 2, 1, 0},  // 2Ì‡. - é«˜éŸ³Reï¼Œé™„ç‚¹å…«åˆ†éŸ³ç¬¦ï¼Œæ— å»¶éŸ³
};

// è½¬æ¢ä¸ºNoteæ•°ç»„ï¼ˆç”¨äºæ’­æ”¾ï¼‰
Note playback_melody[] = {
    {NOTE_E5, 619},   // 3Ì‡ - 659Hz, 619ms
    {NOTE_D3, 619},   // 2Ì² - 147Hz, 619ms
    {NOTE_C4, 619},   // 1 - 262Hz, 619ms
    {NOTE_D3, 619},   // 2Ì² - 147Hz, 619ms
    {NOTE_E5, 1857},  // 3Ì‡. - 659Hz, 1857ms (é™„ç‚¹å››åˆ†éŸ³ç¬¦)
    {NOTE_F4, 619},   // 4 - 349Hz, 619ms
    {NOTE_E5, 619},   // 3Ì‡ - 659Hz, 619ms
    {NOTE_D5, 929},   // 2Ì‡. - 587Hz, 929ms (é™„ç‚¹å…«åˆ†éŸ³ç¬¦)
};
```

## é«˜çº§ç¬¦å·å¤„ç†

### è¿éŸ³çº¿ï¼ˆâŒ’ï¼‰

**ä½œç”¨**ï¼šè¡¨ç¤ºéŸ³ç¬¦è¦è¿è´¯æ¼”å¥ï¼Œä¸å½±å“æ—¶å€¼
**å¤„ç†**ï¼šåœ¨è¿ç»­éŸ³ç¬¦é—´å‡å°‘é—´éš”

```c
// è¿éŸ³ç¬¦ç¤ºä¾‹ï¼š3âŒ’4âŒ’5
NumberedNote legato_example[] = {
    {3, 4, 0, 2, 0, 0},  // 3 - å…«åˆ†éŸ³ç¬¦
    {4, 4, 0, 2, 0, 0},  // 4 - å…«åˆ†éŸ³ç¬¦  
    {5, 4, 0, 2, 0, 0},  // 5 - å…«åˆ†éŸ³ç¬¦
};

// æ’­æ”¾æ—¶å¯ä»¥åœ¨éŸ³ç¬¦é—´å‡å°‘åœé¡¿æ—¶é—´
```

### ç‰¹æ®Šæƒ…å†µå¤„ç†

#### ä½éŸ³å‡é™å·

| ç®€è°± | é¢‘ç‡ | ä»£ç  |
|------|------|------|
| 1Ì²# | 139Hz | {1, 3, 1, 2, 0, 0} |
| 5Ì²# | 208Hz | {5, 3, 1, 2, 0, 0} |

#### é«˜éŸ³å‡é™å·

| ç®€è°± | é¢‘ç‡ | ä»£ç  |
|------|------|------|
| 1Ì‡# | 554Hz | {1, 5, 1, 2, 0, 0} |
| 5Ì‡# | 831Hz | {5, 5, 1, 2, 0, 0} |

## å®ç”¨è½¬æ¢å·¥å…·å‡½æ•°

### æ‰¹é‡è½¬æ¢å‡½æ•°

```c
// æ’­æ”¾æ•°å­—ç®€è°±
void Play_Numbered_Melody(const NumberedNote *numbered_melody, 
                         uint16_t length, 
                         TimeSignature time_sig, 
                         uint8_t bpm);

// è·å–å•ä¸ªéŸ³ç¬¦é¢‘ç‡
uint16_t get_frequency_from_numbered_note(const NumberedNote *note);

// è·å–å•ä¸ªéŸ³ç¬¦æ—¶é•¿
uint16_t get_duration_from_note_value(const NumberedNote *note, 
                                     TimeSignature time_sig, 
                                     uint8_t bpm);
```

### ä½¿ç”¨ç¤ºä¾‹

```c
// 6/8æ‹ã€Šæ˜¥æ—¥å½±ã€‹
Play_Numbered_Melody(haruhi_no_kage, 
                    sizeof(haruhi_no_kage)/sizeof(NumberedNote), 
                    TIME_SIGNATURE_6_8, 
                    97);

// 4/4æ‹ã€Šå°æ˜Ÿæ˜Ÿã€‹
Play_Numbered_Melody(twinkle_star_44, 
                    sizeof(twinkle_star_44)/sizeof(NumberedNote), 
                    TIME_SIGNATURE_4_4, 
                    120);

// 3/4æ‹ã€Šç”Ÿæ—¥å¿«ä¹ã€‹ï¼ˆå«å‡é™å·ï¼‰
Play_Numbered_Melody(happy_birthday_sharps, 
                    sizeof(happy_birthday_sharps)/sizeof(NumberedNote), 
                    TIME_SIGNATURE_3_4, 
                    90);
```

## æ³¨æ„äº‹é¡¹

1. **BPMå½±å“**ï¼šç›¸åŒéŸ³ç¬¦åœ¨ä¸åŒBPMä¸‹æ—¶é•¿ä¸åŒ
2. **æ‹å·å½±å“**ï¼šåŸºç¡€éŸ³ç¬¦æ—¶å€¼éšæ‹å·å˜åŒ–
3. **é¢‘ç‡ç²¾åº¦**ï¼šå‡é™å·ä½¿ç”¨ä¹˜é™¤æ³•è®¡ç®—ï¼Œå¯èƒ½æœ‰è½»å¾®è¯¯å·®
4. **å†…å­˜è€ƒè™‘**ï¼šé•¿ä¹æ›²éœ€è¦è¶³å¤Ÿçš„RAMå­˜å‚¨è½¬æ¢åçš„Noteæ•°ç»„
5. **æ’­æ”¾é˜»å¡**ï¼šå½“å‰ç‰ˆæœ¬ä¸ºåŒæ­¥æ’­æ”¾ï¼Œä¼šé˜»å¡å…¶ä»–ä»»åŠ¡

## èŠ‚æ‹ä¸æ—¶å€¼å¯¹ç…§

### åŸºæœ¬æ—¶å€¼ï¼ˆä»¥å››åˆ†éŸ³ç¬¦=500msä¸ºä¾‹ï¼‰

| ç¬¦å· | åç§° | æ—¶å€¼ | ä»£ç æ—¶é•¿(ms) |
|------|------|------|--------------|
| â™©    | å››åˆ†éŸ³ç¬¦ | 1æ‹ | 500 |
| â™©.   | é™„ç‚¹å››åˆ†éŸ³ç¬¦ | 1.5æ‹ | 750 |
| â™©    | äºŒåˆ†éŸ³ç¬¦ | 2æ‹ | 1000 |
| â™©..  | é™„ç‚¹äºŒåˆ†éŸ³ç¬¦ | 3æ‹ | 1500 |
| â—‹    | å…¨éŸ³ç¬¦ | 4æ‹ | 2000 |
| â™ª    | å…«åˆ†éŸ³ç¬¦ | 0.5æ‹ | 250 |
| â™ª.   | é™„ç‚¹å…«åˆ†éŸ³ç¬¦ | 0.75æ‹ | 375 |
| â™¬    | åå…­åˆ†éŸ³ç¬¦ | 0.25æ‹ | 125 |
| 0    | ä¼‘æ­¢ç¬¦ | è§†æƒ…å†µè€Œå®š | ç›¸åŒæ—¶é•¿ |

### èŠ‚æ‹é€Ÿç‡ä¸ºå…¶ä»–å€¼æ—¶çš„è®¡ç®—å…¬å¼

```c
// åŸºç¡€æ—¶é•¿ï¼ˆå››åˆ†éŸ³ç¬¦ï¼‰
int base_duration = 60000 / BPM;  // BPM: æ¯åˆ†é’ŸèŠ‚æ‹æ•°

// å„éŸ³ç¬¦æ—¶é•¿
int whole_note = base_duration * 4;      // å…¨éŸ³ç¬¦
int half_note = base_duration * 2;       // äºŒåˆ†éŸ³ç¬¦
int quarter_note = base_duration;        // å››åˆ†éŸ³ç¬¦
int eighth_note = base_duration / 2;     // å…«åˆ†éŸ³ç¬¦
int sixteenth_note = base_duration / 4;  // åå…­åˆ†éŸ³ç¬¦
```

## è½¬æ¢æ­¥éª¤

### 1. åˆ†æä¹è°±

ä»¥ã€Šå°æ˜Ÿæ˜Ÿã€‹ä¸ºä¾‹ï¼š
```
1 1 5 5 | 6 6 5 - | 4 4 3 3 | 2 2 1 - |
```

### 2. ç¡®å®šèŠ‚æ‹é€Ÿåº¦

å‡è®¾é€‰æ‹©BPM=120ï¼ˆæ¯åˆ†é’Ÿ120æ‹ï¼‰ï¼Œåˆ™å››åˆ†éŸ³ç¬¦=500ms

### 3. æ–‡æœ¬è¡¨ç¤ºè§„åˆ™

ä¸ºäº†åœ¨æ–‡æœ¬ä¸­è¡¨ç¤ºä¸åŒå…«åº¦çš„éŸ³ç¬¦ï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹è§„åˆ™ï¼š
- **åŸºæœ¬éŸ³åŒºï¼ˆä¸­éŸ³ï¼‰**ï¼šç›´æ¥ç”¨æ•°å­— 1-7
- **é«˜éŸ³åŒº**ï¼šæ•°å­—ååŠ ç‚¹ï¼Œå¦‚ 1. 2. 3. ç­‰
- **ä½éŸ³åŒº**ï¼šæ•°å­—ååŠ Lï¼Œå¦‚ 1L 2L 3L ç­‰
- **ä¼‘æ­¢ç¬¦**ï¼šç”¨ 0 è¡¨ç¤º

### 4. é€ä¸ªè½¬æ¢

| ä½ç½® | ç®€è°± | éŸ³ç¬¦ | å…«åº¦ | æ—¶å€¼(ms) | ä»£ç  |
|------|------|------|------|----------|------|
| 1    | 1    | Do   | 4    | 500 | {1, 4, 4, 0} |
| 2    | 1    | Do   | 4    | 500 | {1, 4, 4, 0} |
| 3    | 5    | Sol  | 4    | 500 | {5, 4, 4, 0} |
| 4    | 5    | Sol  | 4    | 500 | {5, 4, 4, 0} |
| 5    | 6    | La   | 4    | 500 | {6, 4, 4, 0} |
| 6    | 6    | La   | 4    | 500 | {6, 4, 4, 0} |
| 7    | 5-   | Sol  | 4    | 1000 | {5, 4, 8, 0} |
| ...  | ...  | ...  | ...  | ... | ... |

### 5. å«ä½éŸ³çš„ç¤ºä¾‹

å‡è®¾æœ‰æ—‹å¾‹ï¼š
```
1L 1 1. | 2L 2 2. | 3L 3 3. |
```

è½¬æ¢ä¸ºä»£ç ï¼š
```c
NumberedNote melody[] = {
    {1, 3, 4, 0},  // 1L - ä½éŸ³Doï¼Œå…«åº¦3
    {1, 4, 4, 0},  // 1 - ä¸­éŸ³Doï¼Œå…«åº¦4  
    {1, 5, 4, 0},  // 1. - é«˜éŸ³Doï¼Œå…«åº¦5
    {2, 3, 4, 0},  // 2L - ä½éŸ³Reï¼Œå…«åº¦3
    {2, 4, 4, 0},  // 2 - ä¸­éŸ³Reï¼Œå…«åº¦4
    {2, 5, 4, 0},  // 2. - é«˜éŸ³Reï¼Œå…«åº¦5
    // ...
};
```

### 4. ç”Ÿæˆæœ€ç»ˆæ•°ç»„

```c
Note twinkle_star[] = {
    {NOTE_C4, 500}, {NOTE_C4, 500}, {NOTE_G4, 500}, {NOTE_G4, 500},
    {NOTE_A4, 500}, {NOTE_A4, 500}, {NOTE_G4, 1000},
    {NOTE_F4, 500}, {NOTE_F4, 500}, {NOTE_E4, 500}, {NOTE_E4, 500},
    {NOTE_D4, 500}, {NOTE_D4, 500}, {NOTE_C4, 1000},
    // ... åç»­éƒ¨åˆ†
};
```

## ç‰¹æ®Šç¬¦å·å¤„ç†

### å»¶é•¿çº¿ï¼ˆ-ï¼‰
è¡¨ç¤ºå»¶é•¿å‰ä¸€ä¸ªéŸ³ç¬¦çš„æ—¶å€¼ï¼Œé€šå¸¸ä¸ºå‰ä¸€éŸ³ç¬¦æ—¶å€¼çš„ä¸€åŠæˆ–ä¸€å€ã€‚

### é‡å¤ç¬¦å·
- â€–:ï¼šï¼šâ€– - é‡å¤æ ‡è®°
- ä»å¤´é‡å¤ï¼šè·³è½¬åˆ°å¼€å¤´

### è°ƒå·
- 1=Cï¼šCå¤§è°ƒï¼Œä½¿ç”¨åŸºç¡€éŸ³ç¬¦è¡¨
- 1=Dï¼šDå¤§è°ƒï¼Œæ‰€æœ‰éŸ³ç¬¦ç›¸åº”å‡é«˜ä¸€ä¸ªå¤§äºŒåº¦

## å®ç”¨å·¥å…·

### ç®€å•è½¬æ¢å‡½æ•°æ¨¡æ¿

```c
// æ ¹æ®æ•°å­—ç®€è°±è·å–é¢‘ç‡
uint16_t get_frequency_from_note(int note, int octave) {
    switch(note) {
        case 1: return (octave == 4) ? NOTE_C4 : NOTE_C5;
        case 2: return (octave == 4) ? NOTE_D4 : NOTE_D5;
        case 3: return (octave == 4) ? NOTE_E4 : NOTE_E5;
        case 4: return (octave == 4) ? NOTE_F4 : NOTE_F5;
        case 5: return (octave == 4) ? NOTE_G4 : NOTE_G5;
        case 6: return (octave == 4) ? NOTE_A4 : NOTE_A5;
        case 7: return (octave == 4) ? NOTE_B4 : NOTE_B5;
        default: return NOTE_REST;
    }
}
```

## æ³¨æ„äº‹é¡¹

1. ä¸åŒæ­Œæ›²å¯èƒ½æœ‰ä¸åŒçš„BPMï¼Œéœ€è¦ç›¸åº”è°ƒæ•´æ—¶å€¼
2. ä¼‘æ­¢ç¬¦ä½¿ç”¨NOTE_RESTï¼ˆ0é¢‘ç‡ï¼‰
3. èŠ‚æ‹å‡†ç¡®æ€§å¯¹æ­Œæ›²æ•ˆæœå¾ˆé‡è¦
4. å¯ä»¥é€šè¿‡å¾®è°ƒæ—¶é•¿æ¥æ”¹å–„å¬æ„Ÿ